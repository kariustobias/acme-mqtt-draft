---
###
# Internet-Draft Markdown Template
#
# Rename this file from draft-todo-yourname-protocol.md to get started.
# Draft name format is "draft-<yourname>-<workgroup>-<name>.md".
#
# For initial setup, you only need to edit the first block of fields.
# Only "title" needs to be changed; delete "abbrev" if your title is short.
# Any other content can be edited, but be careful not to introduce errors.
# Some fields will be set automatically during setup if they are unchanged.
#
# Don't include "-00" or "-latest" in the filename.
# Labels in the form draft-<yourname>-<workgroup>-<name>-latest are used by
# the tools to refer to the current version; see "docname" for example.
#
# This template uses kramdown-rfc: https://github.com/cabo/kramdown-rfc
# You can replace the entire file if you prefer a different format.
# Change the file extension to match the format (.xml for XML, etc...)
#
###
title: "ACME-Based provisioning of device certificates for IoT devices with MQTT"
abbrev: "TODO - Abbreviation"
category: info

docname: draft-todo-yourname-protocol-latest
submissiontype: IETF  # also: "independent", "IAB", or "IRTF"
number:
date:
consensus: true
v: 3
area: AREA
workgroup: WG Working Group
keyword:
 - next generation
 - unicorn
 - sparkling distributed ledger
venue:
  group: WG
  type: Working Group
  mail: WG@example.com
  arch: https://example.com/WG
  github: USER/REPO
  latest: https://example.com/LATEST

author:
 -
    fullname: Tobias Karius
    organization: Your Organization Here
    email: tobias.karius@yahoo.de

normative:

informative:

---

# Abstract

This document extends the Automatic Certificate Management Environment (ACME) [RFC8555] to provision X.509 ceritificates for Internet of Things (IoT) devices by using the Message Queuing Telemetry Transport (MQTT) protocol.

---

# Introduction

The usage IoT devices have become very popular in the past years. 
Therefore, new protocols such as MQTT have been established and are often preferred over protocols as HTTPS.

This document defines a extension to the Automatic Certificate Management Environment (ACME) Protocol by distribung X.509 device certificates via a publish subscriber pattern through the use of the Message Queuing Telemetry Transport (MQTT) protocol.
The ACME Client IoT device would therefore not require to have HTTP/HTTPS supported and can request a certificate from the ACME Server only through MQTT.

# Terminology

MQTT: Message Queuing Telemetry Transport

ACME: Automatic Certificate Management Environment

ACME Client: The Client of the ACME Protocol

ACME Server: The Server of the ACME Protocol


# Specification

## Setup

Since the MQTT Protocol requires a MQTT broker, the initial ACME setup consisting of an ACME Client and an ACME Server needs to be expanded.

The ACME Client and ACME Server will now publish their messages to an MQTT broker, which will forward the incoming messages to the other receiving end.

## Handling Endpoints

Both Client and Server subscribe to the "/acme" endpoint, where all messages will be published on.

Since all messages are using the same endpoint, there needs to be an additional JSON field called "path". The "path" field specifies the HTTPS path of the initial ACME protocol (e.g. "path : directory", which would be the "/acme/directory" path URL in the initial ACME protocol).

## Establishing a secure connection

Since all messages sent over the MQTT protocol are initially open to anyone, all messages between the ACME Client and ACME Server have to be manually encrypted. Otherwise, a third party could read sensitive data or even manipulate data being sent.

The ACME Client will therefore validate the ACME Server's certificate before the account creation step. The public key of the certificate will then be used by the ACME Client to encrypt all data being sent to the Server.

To also encrypt all messages being sent from the ACME Server to the ACME Client, the ACME Server uses the public key from the ACME Clients account, which he received in the account creation step.
[RFC 8555 7.3]

## Iot Device Certificates

Certificates generated by the local ACME server MUST have an expiratoin of three months or less.

## IoT Device Configuration

IoT devices, upon connecting to a network, MUST use the MQTT endpoint "/acme" to determine whether the local network has an ACME server.

## HTTP and DNS Challenge

This draft focuses on issuing device certificates rather than web certificates. The "Common Name" (CN) of the issued certificate would therefore be a unique identifier rather than a domain name.

This makes the validation, that the Identifier belongs only to the ACME Client however much harder.

The DNS challenge can only be performed, if the device certificates would have a domain name as their unique identifer set. This also requires a working DNS environment.

The HTTP challenge would also require the ACME Client to have HTTP supported in addition to the DNS challenge.

## EK Identifier and Challenge

For future work, it be useful to use the "Endorsement Key" (EK) as the unique identifier in the common name. An idea would be to hash the public key, since each EK is uniquely set by the system manufacturer.

As already discussed in the bachelors thesis of Richard Reik, an EK-Challenge would be a useful strategy of making sure, that the Identifier belongs to the ACME Client.

# Conventions and Definitions

{::boilerplate bcp14-tagged}


# Security Considerations

## Key Reuse

The ACME Clients private key is being used for signing purposes. It is also being used for encryption.

## Using TPM cryptography to reduce change of an Account Takeover

It would make sense for the ACME Client to use its "Trusted Platform Module" (TPM) for the key account usage involving encrypting and signing messages. The Client would therefore create an "Attestation Key" (AK).

The TPM is very secure and even in a OS compromise, an attacker would not be able to retrieve the private key. It would therefore make an account takeover much harder.

## Denial of Service

DoS possible, when attacker hijacks the "/acme" MQTT endpoint. IoT Devices would not be able to request certificates, because the ACME Server would not be able to answer the request.
